{% extends "layout.html" %}

{% block title %}
    Pick up
{% endblock %}


{% block Refresh %}
http-equiv="refresh" content="120"
{% endblock %}
<!--  -->>


{% block user %}
    {{ FULLNAME }}
{% endblock %}

{% block header %}
  <h1>Your services status list and pick up</h1>
  <form id="pay_form" action="/payment" method="post">
    <div class="alignment-center">
      <table class="table table-success table-striped-columns table-hover">

        <!-- Table for bikes that ready for pick up  -->
        {% if SERVICES[0] %}
          <thead class="table-dark" style="border: 2px solid black;">
            
              <tr>
                <th scope="col">Service #</th>
                <th scope="col">Service</th>
                <th scope="col">Status</th>
                <th scope="col">Service price</th>
              </tr>
          </thead>

          <tbody>

              <div id="SERVICES">
                {% for service in SERVICES[0] %}

                  <tr class="SERVICE_READY noHover">
                    <th scope="row" class="thStyle" colspan="4" style="background-color:green;">
                      Bike# {{ service["BIKE_ID"] }} - {{ service["BIKE_NAME"] }}
                    </th>
                  </tr>

                  {% for procedure in service["SERVICES"] %}
                    <tr class="SERVICE_READY">
                      <th scope="row">{{ procedure[0] }}</th>
                      <td>{{ procedure[1] }}</td>
                      <td>&#x2611;</td>
                      <td>{{ procedure[2] }}$</td>
                    </tr>
                  {% endfor %}

                  <tr class="SERVICE_READY">
                    <td style="visibility:hidden;"></td>
                    <td style="visibility:hidden;"></td>
                    <td style="visibility:hidden;"></td>

                    <td style="border: 2px solid green;">
                      <div class="form-check td_sum" style="text-align: left;">
                        Total service price: {{ service["TOTAL_PRICE"] }}$
                        <hr>
                        <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault" onClick="checkboxes();">
                        <label class="form-check-label" for="flexSwitchCheckDefault">Pick this bike</label>
                      </div>
                    </td>

                    <!--<td class="td_sum" style="border: 2px solid green;">Total service price: {{ service["TOTAL_PRICE"] }}$</td>-->
                  </tr>
                {% endfor %}
              </div>
          </tbody>
        {% endif %}


        <!-- Table for bikes that still in service  -->
        {% if SERVICES[1] %}

          <thead class="table-dark" style="border: 2px solid black;">
            <tr>
              <th scope="col">Service #</th>
              <th scope="col">Service</th>
              <th scope="col">Status</th>
              <th scope="col">Service price</th>
            </tr>
          </thead>


          <tbody>
              <div id="SERVICES">
                {% for service in SERVICES[1] %}

                  <tr class="SERVICE_IN_Q noHover">
                    <th scope="row" class="thStyle" colspan="4" style="background-color:red;">
                      Bike# {{ service["BIKE_ID"] }} - {{ service["BIKE_NAME"] }}
                    </th>
                  </tr>

                  {% for procedure in service["SERVICES"] %}
                    <tr class="SERVICE_IN_Q">
                      <th scope="row">{{ procedure[0] }}</th>
                      <td>{{ procedure[1] }}</td>
                      {% if procedure[3] == 0 %}
                        <td>&#x2611;</td>
                        <td>{{ procedure[2] }}$</td>
                      {% else %}
                      <td>&#10006;</td>
                      <td>{{ procedure[2] }}$</td>
                      {% endif %}
                    </tr>
                  {% endfor %}

                  {% set BIKE_READY_TIME = service["SERVICES"]|count %}
                  <tr class="SERVICE_IN_Q">
                      <!--<td style="visibility:hidden;"></td>-->
                      <td class="td_sum" colspan="3">This service will be ready on: {{ service["SERVICES"][BIKE_READY_TIME-1][3] }}</td>
                      <td class="td_sum" style="border: 2px solid red;">Total service price: {{ service["TOTAL_PRICE"] }}$</td>
                  </tr>
                {% endfor %}
              </div>
          </tbody>
        {% endif %}
      </table>
    </div>

    <button type="button" class="btn btn-info" id="pay_form_button"> Pick N' Pay for <span class="badge text-bg-secondary" id="count_checkboxes">0</span> bike/s
    </button>

  </form>

<!-- Script for updating checked checkboxes on button-->
<!-- Script for sending form from button-->
<script>
  function checkboxes()
  {
    var inputElems = document.getElementsByTagName("input"),
    count = 0;
    for (var i=0; i<inputElems.length; i++) {
      if (inputElems[i].type == "checkbox" && inputElems[i].checked == true)
      {
        count++;
        const elem = document.getElementById('count_checkboxes');
        elem.innerHTML = count;
      }
  }}


  var form = document.getElementById("pay_form");
  document.getElementById("pay_form_button").addEventListener("click", function () {
    form.submit();
  });
</script>

{% endblock %}






{% block main %}

<h2>Your Service history</h2>


{% endblock %}
